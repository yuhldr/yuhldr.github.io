<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.31/dist/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"yuhldr.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/config.min.js"></script><meta name="description" content="主要针对单机安装slurm，并且开启slurm的并行mpi支持进行了说明，集群安装略有提及，适合有一定计算机基础的人参考"><meta property="og:type" content="article"><meta property="og:title" content="slurm集群安装与踩坑详解"><meta property="og:url" content="https://yuhldr.github.io/posts/bfa79f01.html"><meta property="og:site_name" content="我是谁"><meta property="og:description" content="主要针对单机安装slurm，并且开启slurm的并行mpi支持进行了说明，集群安装略有提及，适合有一定计算机基础的人参考"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://yuhldr.github.io/images/2021-12-26-00-00-51.png"><meta property="article:published_time" content="2021-12-25T15:29:25.000Z"><meta property="article:modified_time" content="2024-08-31T09:28:49.952Z"><meta property="article:author" content="yuh"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="lammps"><meta property="article:tag" content="mpi"><meta property="article:tag" content="slurm"><meta property="article:tag" content="openmpi"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://yuhldr.github.io/images/2021-12-26-00-00-51.png"><link rel="canonical" href="https://yuhldr.github.io/posts/bfa79f01.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://yuhldr.github.io/posts/bfa79f01.html","path":"posts/bfa79f01.html","title":"slurm集群安装与踩坑详解"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>slurm集群安装与踩坑详解 | 我是谁</title><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/third-party/analytics/baidu-analytics.min.js"></script><script async src="https://hm.baidu.com/hm.js?6117f3283ba8b49f47532de022c00688"></script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="alternate" href="/atom.xml" title="我是谁" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">我是谁</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">迷茫就去学习吧</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#slurm-%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3"><span class="nav-number">1.</span> <span class="nav-text">slurm 初步了解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BA%90%E5%AE%89%E8%A3%85"><span class="nav-number">2.</span> <span class="nav-text">源安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6"><span class="nav-number">2.1.</span> <span class="nav-text">安装软件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"><span class="nav-number">3.</span> <span class="nav-text">源码编译安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96"><span class="nav-number">3.1.</span> <span class="nav-text">依赖</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85mysql"><span class="nav-number">3.1.1.</span> <span class="nav-text">安装mysql</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-munge"><span class="nav-number">3.1.2.</span> <span class="nav-text">编译 munge</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-pmix"><span class="nav-number">3.1.3.</span> <span class="nav-text">编译 pmix</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-hwloc"><span class="nav-number">3.1.3.1.</span> <span class="nav-text">编译 hwloc</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-libevent"><span class="nav-number">3.1.3.2.</span> <span class="nav-text">编译 libevent</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%80%E5%90%8E%E7%BC%96%E8%AF%91-pmix"><span class="nav-number">3.1.3.3.</span> <span class="nav-text">最后编译 pmix</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85-openmpi"><span class="nav-number">3.2.</span> <span class="nav-text">编译安装 openmpi</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ucx"><span class="nav-number">3.2.1.</span> <span class="nav-text">ucx</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#openmpi"><span class="nav-number">3.2.2.</span> <span class="nav-text">openmpi</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-slurm"><span class="nav-number">3.3.</span> <span class="nav-text">编译 slurm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E9%80%9A%E8%8A%82%E7%82%B9%E4%B8%8E-master"><span class="nav-number">3.4.</span> <span class="nav-text">连通节点与 master</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">4.</span> <span class="nav-text">配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">4.1.</span> <span class="nav-text">配置数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-slurmdbd.conf"><span class="nav-number">4.2.</span> <span class="nav-text">配置 slurmdbd.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-slurm.conf"><span class="nav-number">4.3.</span> <span class="nav-text">配置 slurm.conf</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E5%91%98%E6%B5%8B%E8%AF%95"><span class="nav-number">5.</span> <span class="nav-text">管理员测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%90%AF"><span class="nav-number">5.1.</span> <span class="nav-text">开启</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">5.2.</span> <span class="nav-text">测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF"><span class="nav-number">5.3.</span> <span class="nav-text">开机自启</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#munge"><span class="nav-number">5.3.1.</span> <span class="nav-text">munge</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#slurmdbd"><span class="nav-number">5.3.2.</span> <span class="nav-text">slurmdbd</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#slurmctld"><span class="nav-number">5.3.3.</span> <span class="nav-text">slurmctld</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#slurmd"><span class="nav-number">5.3.4.</span> <span class="nav-text">slurmd</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95systemd"><span class="nav-number">5.3.5.</span> <span class="nav-text">测试systemd</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4"><span class="nav-number">5.4.</span> <span class="nav-text">查看集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7"><span class="nav-number">5.5.</span> <span class="nav-text">添加用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E5%91%98%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">5.6.</span> <span class="nav-text">管理员常用命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8"><span class="nav-number">6.</span> <span class="nav-text">用户使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lammps%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"><span class="nav-number">7.</span> <span class="nav-text">LAMMPS编译安装</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="yuh" src="/images/yuh.jpg"><p class="site-author-name" itemprop="name">yuh</p><div class="site-description" itemprop="description">一个不务正业的物理生</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">62</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">75</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/yuhldr" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yuhldr" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:yuhldr@qq.com" title="E-Mail → mailto:yuhldr@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div></div></div></div><div class="pjax"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://yuhldr.github.io/posts/bfa79f01.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/yuh.jpg"><meta itemprop="name" content="yuh"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="我是谁"><meta itemprop="description" content="一个不务正业的物理生"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="slurm集群安装与踩坑详解 | 我是谁"><meta itemprop="description" content="主要针对单机安装slurm，并且开启slurm的并行mpi支持进行了说明，集群安装略有提及，适合有一定计算机基础的人参考"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">slurm集群安装与踩坑详解</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-12-25 23:29:25" itemprop="dateCreated datePublished" datetime="2021-12-25T23:29:25+08:00">2021-12-25</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-08-31 17:28:49" itemprop="dateModified" datetime="2024-08-31T17:28:49+08:00">2024-08-31</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Slurm/" itemprop="url" rel="index"><span itemprop="name">Slurm</span></a> </span></span><span id="/posts/bfa79f01.html" class="post-meta-item leancloud_visitors" data-flag-title="slurm集群安装与踩坑详解" title="阅读次数"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>5.1k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>19 分钟</span></span></div><div class="post-description">主要针对单机安装slurm，并且开启slurm的并行mpi支持进行了说明，集群安装略有提及，适合有一定计算机基础的人参考</div></div></header><div class="post-body" itemprop="articleBody"><p>管理员部署 slurm 单机版或者集群版，单机版方便在自己电脑上直接提交一堆程序自动排队，无需等待一个计算完再计算另一个。</p><p>对于 ubuntu21.10 直接使用 apt 安装 slurm、openmpi 测试很完美，但是对于 ubuntu20.04 安装以后 mpi 有问题，后采用源码编译安装 <code>slurm</code>、<code>openmpi</code>、<code>lammps</code>，很完美！</p><p>由于服务器很多时候系统版本很 old，源安装不靠谱，推荐源码编译，我觉得能遇到的坑我遇到的差不多了……</p><ul><li>slurm: 21.08.5</li><li>openmpi: 4.1.2</li><li>lammps: 2021 年 12 月 25 日 git 版</li></ul><p>资料</p><ul><li><p>slurm</p><p><a target="_blank" rel="noopener" href="https://slurm.schedmd.com/quickstart.html">官网文档：Slurm Workload Manager - Quick Start User Guide</a></p><p><a target="_blank" rel="noopener" href="https://slurm.schedmd.com/archive/">不同版本的文档</a></p><p><a target="_blank" rel="noopener" href="https://github.com/SchedMD/slurm">源码 github</a></p><p><a target="_blank" rel="noopener" href="https://download.schedmd.com/slurm/">不同版本的压缩包下载</a></p></li><li><p>pmix: <a target="_blank" rel="noopener" href="https://github.com/openpmix/openpmix/releases">github 源码</a></p></li><li><p>openmpi：<a target="_blank" rel="noopener" href="https://www.open-mpi.org/">官网下载压缩包即可</a></p></li></ul><h2 id="slurm-初步了解">slurm 初步了解</h2><p>一般情况下，一台服务器(<code>master</code>)即主节点用来登录，提交程序，另外一堆服务器(<code>node1</code> <code>node2</code> <code>node3</code> ... <code>nodex</code> ..)用来计算，这些服务器需要有</p><ul><li>一个共同的 linux 账户管理系统，方便快速创建 linux 用户，暂时不管这个（可以用NIS协议：ypbind，yp-tools），</li><li>需要时间同步，暂时也不管这个（可以用网络时间协议: ntp）</li><li>需要有一块硬盘在每一个服务器上都能访问上面的数据，方便计算，暂时也不管这个（可以用网络文件系统 NFS）</li></ul><p>因为下面都是以单机（就只有一台电脑，既可以提交程序，也可以计算程序）为例，其他先不管</p><p><code>slurm</code> 一般意义上包含 3 个程序</p><ul><li><code>slurmdbd</code>: 这个只在主节点(master)上运行，用来同步各个节点之间的数据，一般情况下依赖于 mysql 处理数据即可</li><li><code>slurmctld</code>: 这也只在 master 上运行，用来控制其他计算节点</li><li><code>slurmd</code>: 这个只在计算节点上运行，同时会把一些数据传递到主节点上。</li></ul><p>如果是单机版，上面三个程序都要在这一台电脑上运行，看了上面的，再看官网的这个图大概就明白了</p><figure><img src="./../images/2021-12-26-00-00-51.png" alt="图解slurm"><figcaption aria-hidden="true">图解slurm</figcaption></figure><p>图可见官网：<a target="_blank" rel="noopener" href="https://slurm.schedmd.com/quickstart.html">这里</a></p><p>除了这些，我们还需要一个 <code>slurm</code> 内部用户权限信息管理的软件 <code>munge</code>，如果需要并行，尤其是依赖于 <code>openmpi</code> 的并行程序，比如 <code>lammps</code>，我们必须在编译 <code>slurm</code> 时启动 <code>pmi</code> 插件，都 2021 年了，一般用 <code>pmix</code> (<code>pmix_v3</code>) 标准即可，这个标准 slurm 源码安装默认不支持</p><h2 id="源安装">源安装</h2><p>虽然不靠谱，但是我觉得以后会靠谱的</p><p>不靠谱的原因是，<code>ubuntu2004</code> 的 <code>slurm</code> 是 <code>19.08</code>，不支持 <code>mpix_v4</code>，所以用 apt 直接安装的 openmpi（默认是 4.0 的版本）编译 lammps，在 surm 里使用时会报错</p><p>但是，<code>ubuntu21.10</code> 的 <code>slurm</code> 对 <code>openmpi4</code> 支持很好，为了深入了解 <code>slurm</code>、<code>mpi</code>、<code>lammps</code>，我认为还是选择源码安装，这里的源安装留个记录，因为没有教程的情况下，这个小幅度的成功，有利于继续</p><p>至于怎么知道你安装的 <code>slurm</code> 支持哪种 <code>mpi</code>，安装以后输入 <code>srun --mpi=list</code> 即可去，<strong><em>切记 <code>openmpi</code> 的版本与 <code>slurm</code> 支持的 <code>mpi</code> 完全符合</em></strong>。</p><h3 id="安装软件">安装软件</h3><p>对于 <code>ubuntu</code> 来说，centos 一般情况把 <code>apt</code> 换成 <code>yum</code> 就可以了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装用户权限管理 munge</span></span><br><span class="line"><span class="built_in">sudo</span> apt install munge</span><br><span class="line"><span class="comment"># 安装slurmdbd的数据库支持mysql，目前最新版一般都是mysql8了</span></span><br><span class="line"><span class="built_in">sudo</span> apt install mysql-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装slurm基础插件</span></span><br><span class="line"><span class="comment"># 不同系统版本不一样，所以最好是先搜索一下，注意 slurm/impish 0.4.3-2build4  这个软件不是slurm！</span></span><br><span class="line"><span class="built_in">sudo</span> apt search slurm | grep slurm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们只需安装 `slurm-wlm` 即可，除了slurmdbd其他几个都会被自动安装</span></span><br><span class="line"><span class="comment"># 但是不同系统版本不一样，这个名字都可能不一样，对于ubuntu20.04和ubuntu21.10都是这个</span></span><br><span class="line"><span class="comment"># 但是版本也不一样，ubuntu20.04是slurm19，ubuntu21.04是slurm20，但是现在最新版是slurm21</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> apt install slurm-wlm slurmdbd</span><br><span class="line"><span class="comment"># 注意，包含 `emulator` 的那两个不要安装，否则会报错</span></span><br></pre></td></tr></table></figure><p>这就安装完了，需要配置 数据库 和 slurm.conf 以及 slurmdbd.conf 两个文件，在后面的源码编译安装中会详细介绍</p><h2 id="源码编译安装">源码编译安装</h2><p>我都单独安装在 <code>/usr/local</code> 里面了，每个软件单独创建文件夹，没有撒在这个目录里，因此需要设置环境变量</p><p>我准备在 <code>~/code/slurm_data</code> 这个文件夹里编译</p><p>你怎么解压下载的源码都行，我用了 <a href="./fa905576.html">终端工具 oh-my-zsh 与 p10k 国内镜像安装</a> 的解压插件直接解压</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x 压缩包文件名</span><br></pre></td></tr></table></figure><p>要注意，github 下载的这个 release 与 git clone 源码不一样，这个不用 auto-tool 那一步，直接三步走编译安装即可</p><h3 id="依赖">依赖</h3><p>对于ubuntu20.04依赖如下，其他的根据报错，自己修改</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> -E apt-get install git build-essential libssl-dev mysql-client mysql-server libmysql++-dev ffmpeg python3-pip openssh-server cmake -y</span><br></pre></td></tr></table></figure><p>其中没有 <code>libmysql++-dev</code> slurm是没法使用mysql数据库的</p><p>对于 <code>opensuse</code> 系统数据库默认为 <code>mariadb</code> 所以需要的库为 <code>libmariadb-devel</code></p><p>我们需要</p><ul><li><p>mysql-server libmysql</p></li><li><p>munge</p></li><li><p>pmix</p><p>但是当前<code>slurm-21.08.5</code> 不支持最新版 pmix，需要这个<a target="_blank" rel="noopener" href="https://github.com/openpmix/openpmix/releases/tag/v3.2.3">pmix-3.2.3</a></p><p>怎么知道支持哪个？直接最新版，如果后面编译不支持，会有报错，这个在官网有说明，但是不在管理员文档里，在<a target="_blank" rel="noopener" href="https://slurm.schedmd.com/mpi_guide.html">用户文档</a>里</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">checking <span class="keyword">for</span> pmix installation...</span><br><span class="line">configure: WARNING: unable to locate pmix installation</span><br></pre></td></tr></table></figure></li></ul><h4 id="安装mysql">安装mysql</h4><p>这个各个系统更新都比较及时，直接安装吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install mysql-server</span><br></pre></td></tr></table></figure><p>但是注意这个还不够，编译slurm时会找不到，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt search libmysql | grep lib</span><br></pre></td></tr></table></figure><p>一般有一个类似这个的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">libmysql++-dev/impish,now 3.2.5-2 amd64 [已安装]</span><br><span class="line">  MySQL C++ library bindings (development)</span><br></pre></td></tr></table></figure><p>安装上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install libmysql++-dev</span><br></pre></td></tr></table></figure><h4 id="编译-munge">编译 munge</h4><p>去 github 下载，<a target="_blank" rel="noopener" href="https://github.com/dun/munge/releases">Releases · dun/munge</a></p><p><a target="_blank" rel="noopener" href="https://github.com/dun/munge/releases/download/munge-0.5.14/munge-0.5.14.tar.xz">https://github.com/dun/munge/releases/download/munge-0.5.14/munge-0.5.14.tar.xz</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/code/slurm_data</span><br><span class="line"></span><br><span class="line">wget https://github.com/dun/munge/releases/download/munge-0.5.14/munge-0.5.14.tar.xz</span><br><span class="line"></span><br><span class="line">x munge-0.5.14.tar.xz</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> munge-0.5.14</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装目录 /usr/local/munge-0.5.14</span></span><br><span class="line">./configure --prefix=/usr/local/munge-0.5.14</span><br><span class="line"></span><br><span class="line"><span class="comment"># -j 指的是用所有cpu核心编译</span></span><br><span class="line">make -j</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装到刚才的目录</span></span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置一个版本通用的连接</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local &amp;&amp; <span class="built_in">sudo</span> <span class="built_in">ln</span> -s munge-0.5.14 munge &amp;&amp; <span class="built_in">cd</span> - &amp;&amp; <span class="built_in">cd</span> ../</span><br></pre></td></tr></table></figure><p>添加环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/profile.d/munge.sh</span><br></pre></td></tr></table></figure><p>添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> MUNGE_HOME=/usr/local/munge</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$MUNGE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$MUNGE_HOME</span>/sbin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><p>重新打开 bash 以后生效</p><h4 id="编译-pmix">编译 pmix</h4><p>它又需要两个东西，注意版本号</p><ul><li>hwloc</li><li>libevent</li></ul><p>为什么我知道呢，因为直接会报错，所以先编译他们</p><p>pmix 也是去 github 找的，前面介绍了，slurm-21.08.5 只能用 pmix3</p><h5 id="编译-hwloc">编译 hwloc</h5><p><a target="_blank" rel="noopener" href="https://github.com/open-mpi/hwloc/releases">Releases · open-mpi/hwloc</a>，我直接用的最新的，其实也是 2019 年的，下载这个文件 <a target="_blank" rel="noopener" href="https://github.com/open-mpi/hwloc/releases/download/hwloc-2.1.0/hwloc-2.1.0.tar.bz2">hwloc-2.1.0</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载 hwloc，根据前面的介绍，去github找的</span></span><br><span class="line">wget https://github.com/open-mpi/hwloc/releases/download/hwloc-2.1.0/hwloc-2.1.0.tar.bz2</span><br><span class="line"></span><br><span class="line">x hwloc-2.1.0.tar.bz2</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> hwloc-2.1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装目录 /usr/local/hwloc-2.1.0</span></span><br><span class="line">./configure --prefix=/usr/local/hwloc-2.1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># -j 指的是用所有cpu核心编译</span></span><br><span class="line">make -j</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装到刚才的目录</span></span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置一个版本通用的连接</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local &amp;&amp; <span class="built_in">sudo</span> <span class="built_in">ln</span> -s hwloc-2.1.0 hwloc &amp;&amp; <span class="built_in">cd</span> - &amp;&amp; <span class="built_in">cd</span> ../</span><br></pre></td></tr></table></figure><h5 id="编译-libevent">编译 libevent</h5><p><a target="_blank" rel="noopener" href="https://github.com/libevent/libevent/releases">Releases · libevent/libevent</a>，我用的最新的，<a target="_blank" rel="noopener" href="https://github.com/libevent/libevent/releases/download/release-2.1.12-stable/libevent-2.1.12-stable.tar.gz">libevent-2.1.12-stable.tar.gz</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载 libevent，根据前面的介绍，去github找的</span></span><br><span class="line">wget https://github.com/libevent/libevent/releases/download/release-2.1.12-stable/libevent-2.1.12-stable.tar.gz</span><br><span class="line"></span><br><span class="line">x libevent-2.1.12-stable.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> libevent-2.1.12-stable</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装目录 /usr/local/libevent-2.1.12</span></span><br><span class="line">./configure --prefix=/usr/local/libevent-2.1.12</span><br><span class="line"></span><br><span class="line"><span class="comment"># -j 指的是用所有cpu核心编译</span></span><br><span class="line">make -j</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装到刚才的目录</span></span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置一个版本通用的连接</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local &amp;&amp; <span class="built_in">sudo</span> <span class="built_in">ln</span> -s libevent-2.1.12 libevent &amp;&amp; <span class="built_in">cd</span> - &amp;&amp; <span class="built_in">cd</span> ../</span><br></pre></td></tr></table></figure><h5 id="最后编译-pmix">最后编译 pmix</h5><p>去 github 找，<a target="_blank" rel="noopener" href="https://github.com/openpmix/openpmix/releases">Releases · openpmix/openpmix</a>，前面说了，目前 slurm 只能用版本：</p><p><a target="_blank" rel="noopener" href="https://github.com/openpmix/openpmix/releases/download/v3.2.3/pmix-3.2.3.tar.bz2">https://github.com/openpmix/openpmix/releases/download/v3.2.3/pmix-3.2.3.tar.bz2</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载 pmix，根据前面的介绍，去github找的</span></span><br><span class="line">wget https://github.com/openpmix/openpmix/releases/download/v3.2.3/pmix-3.2.3.tar.bz2</span><br><span class="line"></span><br><span class="line">x pmix-3.2.3.tar.bz2</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> pmix-3.2.3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 必须置顶刚才的两个依赖路径，因为我把他们单独放在一个文件夹了，方便以后更新、删除</span></span><br><span class="line">./configure --prefix=/usr/local/pmix-3.2.3  --with-libevent=/usr/local/libevent --with-hwloc=/usr/local/hwloc</span><br><span class="line"></span><br><span class="line">make -j</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/local &amp;&amp; <span class="built_in">sudo</span> <span class="built_in">ln</span> -s pmix-3.2.3 pmix &amp;&amp; <span class="built_in">cd</span> - &amp;&amp; <span class="built_in">cd</span> ../</span><br></pre></td></tr></table></figure><h3 id="编译安装-openmpi">编译安装 openmpi</h3><p>为了防止别人用其他方法安装的其他版本的 openmpi，在你的 slurm 里不能使用，你给他们编译好吧，注意必须使用 <strong>外部编译</strong>，即使用刚才的 pmix 和相关依赖编译安装，还缺少一个 <code>ucx</code>，一会 <code>slurm</code> 也可以用这个</p><h4 id="ucx">ucx</h4><p><a target="_blank" rel="noopener" href="https://github.com/openucx/ucx/releases">Releases · openucx/ucx</a>，下载绿色的稳定版，直接下载初步编译的源码：</p><p><a target="_blank" rel="noopener" href="https://github.com/openucx/ucx/releases/download/v1.11.2/ucx-1.11.2.tar.gz">https://github.com/openucx/ucx/releases/download/v1.11.2/ucx-1.11.2.tar.gz</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载 ucx，根据前面的介绍，去github找的</span></span><br><span class="line">wget https://github.com/openucx/ucx/releases/download/v1.11.2/ucx-1.11.2.tar.gz</span><br><span class="line"></span><br><span class="line">x ucx-1.11.2.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ucx-1.11.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 必须置顶刚才的两个依赖路径，因为我把他们单独放在一个文件夹了，方便以后更新、删除</span></span><br><span class="line"><span class="comment"># 对于archlinux，报错，最新版已经适配1.12.1</span></span><br><span class="line"><span class="comment"># 旧版可以参考这个解决，https://github.com/openucx/ucx/issues/7955</span></span><br><span class="line">./configure --prefix=/usr/local/ucx-1.11.2</span><br><span class="line"></span><br><span class="line">make -j</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/local &amp;&amp; <span class="built_in">sudo</span> <span class="built_in">ln</span> -s ucx-1.11.2 ucx &amp;&amp; <span class="built_in">cd</span> - &amp;&amp; <span class="built_in">cd</span> ../</span><br></pre></td></tr></table></figure><h4 id="openmpi">openmpi</h4><p><a target="_blank" rel="noopener" href="https://www.open-mpi.org/software/">官网下载</a> 最新的稳定版：<a target="_blank" rel="noopener" href="https://download.open-mpi.org/release/open-mpi/v4.1/openmpi-4.1.2.tar.bz2">https://download.open-mpi.org/release/open-mpi/v4.1/openmpi-4.1.2.tar.bz2</a>，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载</span></span><br><span class="line">wget https://download.open-mpi.org/release/open-mpi/v4.1/openmpi-4.1.2.tar.bz2</span><br><span class="line"></span><br><span class="line">x openmpi-4.1.2.tar.bz2</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> openmpi-4.1.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 必须置顶刚才的两个依赖路径，因为我把他们单独放在一个文件夹了，方便以后更新、删除</span></span><br><span class="line">./configure --prefix=/usr/local/openmpi-4.1.2 --with-pmix=/usr/local/pmix --with-ucx=/usr/local/ucx --with-hwloc=/usr/local/hwloc --with-libevent=/usr/local/libevent</span><br><span class="line"></span><br><span class="line">make -j</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/local &amp;&amp; <span class="built_in">sudo</span> <span class="built_in">ln</span> -s openmpi-4.1.2 openmpi &amp;&amp; <span class="built_in">cd</span> - &amp;&amp; <span class="built_in">cd</span> ../</span><br></pre></td></tr></table></figure><p>添加环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/profile.d/openmpi.sh</span><br></pre></td></tr></table></figure><p>添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> OPENMPI_HOME=/usr/local/openmpi</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$OPENMPI_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$OPENMPI_HOME</span>/lib:<span class="variable">$LD_LIBRARY_PATH</span></span><br></pre></td></tr></table></figure><p>重新打开 bash 以后生效</p><h3 id="编译-slurm">编译 slurm</h3><p><a target="_blank" rel="noopener" href="https://download.schedmd.com/slurm/">官网下载</a> 最新的稳定版：<a target="_blank" rel="noopener" href="https://download.schedmd.com/slurm/slurm-21.08.5.tar.bz2">https://download.schedmd.com/slurm/slurm-21.08.5.tar.bz2</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载</span></span><br><span class="line">wget https://download.schedmd.com/slurm/slurm-21.08.5.tar.bz2</span><br><span class="line"></span><br><span class="line">x slurm-21.08.5.tar.bz2</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> slurm-21.08.5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 必须置顶刚才的两个依赖路径，因为我把他们单独放在一个文件夹了，方便以后更新、删除</span></span><br><span class="line">./configure --prefix=/usr/local/slurm-21.08.5 --with-pmix=/usr/local/pmix --with-munge=/usr/local/munge --with-hwloc=/usr/local/hwloc --with-ucx=/usr/local/ucx</span><br><span class="line"></span><br><span class="line">make -j</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/local &amp;&amp; <span class="built_in">sudo</span> <span class="built_in">ln</span> -s slurm-21.08.5 slurm &amp;&amp; <span class="built_in">cd</span> - &amp;&amp; <span class="built_in">cd</span> ../</span><br></pre></td></tr></table></figure><p>添加环境变量，bash 全局的话可以放在</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/profile.d/slurm.sh</span><br></pre></td></tr></table></figure><p>添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> SLURM_HOME=/usr/local/slurm</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$SLURM_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$SLURM_HOME</span>/sbin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$SLURM_HOME</span>/lib:<span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$SLURM_HOME</span>/lib/slurm:<span class="variable">$LD_LIBRARY_PATH</span></span><br></pre></td></tr></table></figure><h3 id="连通节点与-master">连通节点与 master</h3><p>对于多台服务器需要，单机不需要</p><p>每一台服务器都如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果没有ssh，安装</span></span><br><span class="line"><span class="built_in">sudo</span> apt install openssh-server openssh-sftp-server openssh-client</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果没有，生成密钥</span></span><br><span class="line">ssh-keygen</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加hosts</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">echo</span> <span class="string">&quot;ip地址 名字&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="comment"># 比如</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">echo</span> <span class="string">&quot;196.10.10.1 master&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">echo</span> <span class="string">&quot;196.10.10.2 node1&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">echo</span> <span class="string">&quot;196.10.10.3 node2&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>其中 <code>master</code> 可访问 <code>node</code></p><p>在 master 上输入，比如</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># master免密码访问node1</span></span><br><span class="line">ssh-copy-id node1</span><br><span class="line"><span class="comment"># 初次访问，必须</span></span><br><span class="line">ssh node1</span><br></pre></td></tr></table></figure><h2 id="配置">配置</h2><p>包含数据库、slurm</p><h3 id="配置数据库">配置数据库</h3><blockquote><p>注意都是以源码编译安装为例，安装位置都是按照前面的来的</p></blockquote><p>接下来配置 <code>slurmdbd</code> 需要的数据库，这个即使源码安装 <code>slurm</code> 也需要</p><p>先修改个东西</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/mysql/my.cnf</span><br></pre></td></tr></table></figure><p>vim 会用吧，输入 <code>i</code> 添加下面的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"> innodb_buffer_pool_size=1024M</span><br><span class="line"> innodb_log_file_size=64M</span><br><span class="line"> innodb_lock_wait_timeout=900</span><br></pre></td></tr></table></figure><p><code>:wq</code> 保存</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 然后启动mysql，并设置开机自启，如果只是开: sudo systemctl start mysql</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入mysql，默认root的mysql没有密码，不建议设置</span></span><br><span class="line"><span class="built_in">sudo</span> mysql</span><br></pre></td></tr></table></figure><p>创建 slurm 单独的用户和需要的数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建slurm单独的mysql用户，只本地访问即可，所以密码12345678就可以</span></span><br><span class="line">create user <span class="string">&#x27;slurm&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;12345678&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建基础数据库</span></span><br><span class="line">create database slurm_acct_db;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许slurm用户访问</span></span><br><span class="line">grant all on slurm_acct_db.* TO <span class="string">&#x27;slurm&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建另一个，这个不强制，但是建议，如果不创建，后面slurm配置需要改，所以还是创建吧</span></span><br><span class="line">create database slurm_job_db;</span><br><span class="line"></span><br><span class="line">grant all on slurm_job_db.* TO <span class="string">&#x27;slurm&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure><p>下面的不要输入，但是有兴趣学习 mysql 可以入门</p><p>常用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除用户libmariadb-devel</span></span><br><span class="line"><span class="comment"># 查看有哪些数据库</span></span><br><span class="line">show databases;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某个数据库的表格</span></span><br><span class="line">use slurm_acct_db;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某个表格的杰哥</span></span><br><span class="line">describe 表格名字;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除数据库和数据表</span></span><br><span class="line">drop database 数据库名;</span><br><span class="line">drop table 数据表名;</span><br></pre></td></tr></table></figure><h3 id="配置-slurmdbd.conf">配置 slurmdbd.conf</h3><blockquote><p>注意都是以源码编译安装为例，安装位置都是按照前面的来的</p></blockquote><p>详细可以看 <a target="_blank" rel="noopener" href="https://slurm.schedmd.com/slurmdbd.conf.html">官网 slurmdbd.conf</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ArchiveEvents=yes</span><br><span class="line">ArchiveJobs=yes</span><br><span class="line">ArchiveResvs=yes</span><br><span class="line">ArchiveSteps=no</span><br><span class="line">ArchiveSuspend=no</span><br><span class="line">ArchiveTXN=no</span><br><span class="line">ArchiveUsage=no</span><br><span class="line">AuthInfo=/usr/local/munge/var/run/munge/munge.socket.2</span><br><span class="line">AuthType=auth/munge</span><br><span class="line">DbdHost=localhost</span><br><span class="line">DebugLevel=info</span><br><span class="line">PurgeEventAfter=1month</span><br><span class="line">PurgeJobAfter=12month</span><br><span class="line">PurgeResvAfter=1month</span><br><span class="line">PurgeStepAfter=1month</span><br><span class="line">PurgeSuspendAfter=1month</span><br><span class="line">PurgeTXNAfter=12month</span><br><span class="line">PurgeUsageAfter=24month</span><br><span class="line">LogFile=/var/log/slurmdbd.log</span><br><span class="line">PidFile=/var/run/slurmdbd.pid</span><br><span class="line">SlurmUser=root</span><br><span class="line">StoragePass=12345678</span><br><span class="line">StorageType=accounting_storage/mysql</span><br><span class="line">StorageUser=slurm</span><br><span class="line">StorageHost=localhost</span><br><span class="line">StoragePort=3306</span><br></pre></td></tr></table></figure><p>上面的配置直接复制的官网的，不同版本 slurm 有区别，但是我觉得区别不大，关键有几个点注意</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">; 使用munge</span><br><span class="line">AuthType=auth/munge</span><br><span class="line"></span><br><span class="line">; munge安装未知</span><br><span class="line">AuthInfo=/usr/local/munge/var/run/munge/munge.socket.2</span><br><span class="line"></span><br><span class="line">; 数据库位置，这个就行，因为slurmdbdb只在master上</span><br><span class="line">DbdHost=localhost</span><br><span class="line"></span><br><span class="line">; 我们就不要新建用户了，直接root更方便</span><br><span class="line">SlurmUser=root</span><br><span class="line"></span><br><span class="line">; 开启数据插件</span><br><span class="line">StorageType=accounting_storage/mysql</span><br><span class="line">; 数据库的新建用户</span><br><span class="line">StorageUser=slurm</span><br><span class="line">; 数据库这个用户的密码</span><br><span class="line">StoragePass=12345678</span><br><span class="line">; 数据库位置在master，也就是本地</span><br><span class="line">StorageHost=localhost</span><br><span class="line">; 数据库默认端口</span><br><span class="line">StoragePort=3306</span><br></pre></td></tr></table></figure><p>文件生成以后放在 <code>/usr/local/slurm/etc/slurmdbd.conf</code></p><p>如果是源安装，不在这里，而且不同版本不一样，一般是在<code>/etc/slurm-</code> 后面的名字不一样</p><h3 id="配置-slurm.conf">配置 slurm.conf</h3><blockquote><p>注意都是以源码编译安装为例，安装位置都是按照前面的来的</p></blockquote><p>这个去官网 <a target="_blank" rel="noopener" href="https://slurm.schedmd.com/configurator.html">Slurm System Configuration Tool</a> 自动生成即可，不同版本不一样，其中比较重要的是</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">; 单机就是 localhost即可</span><br><span class="line">SlurmctldHost=localhost</span><br><span class="line"></span><br><span class="line">; 这个是mpi的默认值，用户输入 --mpi=mpix_v3 这时候会覆盖这个</span><br><span class="line">MpiDefault=pmix</span><br><span class="line"></span><br><span class="line">; 这个优先用cgroup，如果报错，换这个</span><br><span class="line">ProctrackType=proctrack/linuxproc</span><br><span class="line"></span><br><span class="line">; 下面这些都是数据库相关的，配置一下就行</span><br><span class="line">AccountingStorageHost=localhost</span><br><span class="line">; 合格是munge的位置</span><br><span class="line">AccountingStoragePass=/usr/local/munge/var/run/munge/munge.socket.2</span><br><span class="line">AccountingStorageType=accounting_storage/slurmdbd</span><br><span class="line">AccountingStorageUser=slurm</span><br><span class="line">JobCompHost=localhost</span><br><span class="line">JobCompLoc=slurm_job_db</span><br><span class="line">JobCompPass=12345678</span><br><span class="line">JobCompType=jobcomp/mysql</span><br><span class="line">JobCompUser=slurm</span><br><span class="line"></span><br><span class="line">; 这个是各个计算节点，单机的话直接 localhost就行，至于CPUs就是你的cpu核心数，错了也没事，一会开启时会有提示应该是多少，Sockets，cpu插槽数；CoresPerSocket每个插槽多少核心，ThreadsPerCore每个核心多少线程， RealMemory内存（不设置的话，用户申请--mem会报错）</span><br><span class="line">NodeName=localhost CPUs=6 Sockets=1 CoresPerSocket=6 ThreadsPerCore=1 RealMemory=32041 State=UNKNOWN</span><br><span class="line">PartitionName=ptt1 Nodes=ALL Default=YES MaxTime=INFINITE State=UP</span><br></pre></td></tr></table></figure><p>文件生成以后放在 <code>/usr/local/slurm/etc/slurm.conf</code></p><p>如果是源安装，不在这里，而且不同版本不一样，一般是在<code>/etc/slurm-</code> 后面的名字不一样</p><h2 id="管理员测试">管理员测试</h2><h3 id="开启">开启</h3><blockquote><p>注意都是以源码编译安装为例，安装位置都是按照前面的来的， 已经配置好了环境变量</p></blockquote><p>先开启 munge</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到root</span></span><br><span class="line"><span class="built_in">sudo</span> su</span><br><span class="line"><span class="comment"># 输入</span></span><br><span class="line">munged</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是否有报错，没有error就行</span></span><br><span class="line"><span class="built_in">cat</span> /usr/local/munge/var/log/munge/munged.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过几秒再看看，是否有问题</span></span><br><span class="line">ps aux | grep munge</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果包含类似这个的，就没问题</span></span><br><span class="line">root        1096  0.0  0.0 204152  3676 ?        Sl   12月25   0:01 /usr/local/munge/sbin/munged</span><br></pre></td></tr></table></figure><p>开启 slurmdbd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仍然在root</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入</span></span><br><span class="line">slurmdbd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是否有报错，你启动以后的时间里没有error就行，之前的error没事</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/slurmdbd.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过几秒再看看，是否有问题</span></span><br><span class="line">ps aux | grep slurmdbd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果包含类似这个的，就没问题</span></span><br><span class="line">root        2631  0.0  0.0 288368 10012 ?        Ssl  12月25   0:00 /usr/local/slurm/sbin/slurmdbd -D</span><br></pre></td></tr></table></figure><p>开启 slurmctld</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仍然在root</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入</span></span><br><span class="line">slurmctld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是否有报错，你启动以后的时间里没有error就行，之前的error没事</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/slurmctld.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过几秒再看看，是否有问题</span></span><br><span class="line">ps aux | grep slurmctld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果包含类似这个的，就没问题</span></span><br><span class="line">root        2631  0.0  0.0 288368 10012 ?        Ssl  12月25   0:00 /usr/local/slurm/sbin/slurmctld -D</span><br></pre></td></tr></table></figure><p>前面的没问题再开启 slurmd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仍然在root</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入</span></span><br><span class="line">slurmd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是否有报错，你启动以后的时间里没有error就行，之前的error没事</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/slurmd.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 报错1，可能因为之前slurm.conf最后，服务器cpu等填的不对，这时候会有提示，根据那个改一下</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 报错2，可能有cgroup相关的报错，之前slurm.conf，ProctrackType=proctrack/cgroup，改为ProctrackType=proctrack/linuxproc</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过几秒再看看，是否有问题</span></span><br><span class="line">ps aux | grep slurmd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果包含类似这个的，就没问题</span></span><br><span class="line">root        2631  0.0  0.0 288368 10012 ?        Ssl  12月25   0:00 /usr/local/slurm/sbin/slurmd -D</span><br></pre></td></tr></table></figure><h3 id="测试">测试</h3><p>重新打开 bash 以后生效</p><p>测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srun --mpi=list</span><br></pre></td></tr></table></figure><p>正常能看到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">srun: MPI types are...</span><br><span class="line">srun: pmix</span><br><span class="line">srun: pmix_v3</span><br><span class="line">srun: cray_shasta</span><br><span class="line">srun: none</span><br><span class="line">srun: pmi2</span><br></pre></td></tr></table></figure><h3 id="开机自启">开机自启</h3><p>一共 4 个自己编译安装的，用 systemd 进行管理启动，单机的话直接配置就行，如果是集群，</p><ul><li>master: munge slurmdbd slurmctld</li><li>node: munge slurmd</li></ul><h4 id="munge">munge</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/systemd/system/munge.service</span><br></pre></td></tr></table></figure><p>添加这个</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># /etc/systemd/system/munge.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=MUNGE authentication service</span><br><span class="line">Documentation=man:munged(8)</span><br><span class="line">After=network.target</span><br><span class="line">After=time-sync.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">EnvironmentFile=-/usr/local/mung/etc/default/munge</span><br><span class="line">ExecStart=/usr/local/munge/sbin/munged $OPTIONS</span><br><span class="line">PIDFile=/usr/local/munge/var/run/munge/munged.pid</span><br><span class="line">RuntimeDirectory=munge</span><br><span class="line">RuntimeDirectoryMode=0755</span><br><span class="line">Restart=on-abort</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h4 id="slurmdbd">slurmdbd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/systemd/system/slurmdbd.service</span><br></pre></td></tr></table></figure><p>添加这个</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># /lib/systemd/system/slurmdbd.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Slurm DBD accounting daemon</span><br><span class="line">After=network.target munge.service network-online.target mysql.service</span><br><span class="line">Wants=munge.service network-online.target mysql.service</span><br><span class="line">ConditionPathExists=/usr/local/slurm/etc/slurmdbd.conf</span><br><span class="line">Documentation=man:slurmdbd(8)</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">EnvironmentFile=-/etc/default/slurmdbd</span><br><span class="line">ExecStart=/usr/local/slurm/sbin/slurmdbd -D $SLURMDBD_OPTIONS</span><br><span class="line">ExecReload=/bin/kill -HUP $MAINPID</span><br><span class="line">PIDFile=/var/run/slurmdbd.pid</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line">TasksMax=infinity</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h4 id="slurmctld">slurmctld</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/systemd/system/slurmctld.service</span><br></pre></td></tr></table></figure><p>添加这个</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># /lib/systemd/system/slurmctld.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Slurm controller daemon</span><br><span class="line">After=slurmdbd.service</span><br><span class="line">Wants=slurmdbd.service</span><br><span class="line">ConditionPathExists=/usr/local/slurm/etc/slurm.conf</span><br><span class="line">Documentation=man:slurmctld(8)</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">EnvironmentFile=-/etc/default/slurmctld</span><br><span class="line">ExecStart=/usr/local/slurm/sbin/slurmctld -D $SLURMCTLD_OPTIONS</span><br><span class="line">ExecReload=/bin/kill -HUP $MAINPID</span><br><span class="line">PIDFile=/var/run/slurmctld.pid</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line">TasksMax=infinity</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h4 id="slurmd">slurmd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/systemd/system/slurmd.service</span><br></pre></td></tr></table></figure><p>添加这个</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># /lib/systemd/system/slurmd.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Slurm node daemon</span><br><span class="line">After=remote-fs.target slurmctld.service</span><br><span class="line">Wants=slurmctld.service</span><br><span class="line">ConditionPathExists=/usr/local/slurm/etc/slurm.conf</span><br><span class="line">Documentation=man:slurmd(8)</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">EnvironmentFile=-/etc/default/slurmd</span><br><span class="line">ExecStart=/usr/local/slurm/sbin/slurmd -D $SLURMD_OPTIONS</span><br><span class="line">ExecReload=/bin/kill -HUP $MAINPID</span><br><span class="line">PIDFile=/var/run/slurmd.pid</span><br><span class="line">KillMode=process</span><br><span class="line">LimitNOFILE=131072</span><br><span class="line">LimitMEMLOCK=infinity</span><br><span class="line">LimitSTACK=infinity</span><br><span class="line">Delegate=yes</span><br><span class="line">TasksMax=infinity</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h4 id="测试systemd">测试systemd</h4><p>其实直接重启就行，如果不想重启，先把刚才测试的进程关闭</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭slurm相关的</span></span><br><span class="line">ps aux | grep slurm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 看到类似这些</span></span><br><span class="line">root        2631  0.0  0.0 288368 10012 ?        Ssl  12月25   0:00 /usr/local/slurm/sbin/slurmdbd -D</span><br><span class="line">root        2632  0.0  0.0 766548 14736 ?        Ssl  12月25   0:36 /usr/local/slurm/sbin/slurmctld -D</span><br><span class="line">root        2633  0.0  0.0  73672  5860 ?        Ss   12月25   0:00 /usr/local/slurm/sbin/slurmd -D</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭，那些数字是从刚才里面找的</span></span><br><span class="line"><span class="built_in">kill</span> 2631 2632 2633</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭munge</span></span><br><span class="line">ps aux | grep munged</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类似</span></span><br><span class="line">root        1096  0.0  0.0 204152  3676 ?        Sl   12月25   0:01 /usr/local/munge/sbin/munged</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭</span></span><br><span class="line"><span class="built_in">kill</span> 1096</span><br></pre></td></tr></table></figure><p>开机自启</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> --now mysql</span><br><span class="line">systemctl <span class="built_in">enable</span> --now munge</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> --now slurmdbd</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> --now slurmctld</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> --now slurmdbd</span><br></pre></td></tr></table></figure><p>查看开启状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl status mysql</span><br><span class="line">systemctl status munge</span><br><span class="line"></span><br><span class="line">systemctl status slurmdbd</span><br><span class="line"></span><br><span class="line">systemctl status slurmctld</span><br><span class="line"></span><br><span class="line">systemctl status slurmdbd</span><br></pre></td></tr></table></figure><p>关闭</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mysql</span><br><span class="line">systemctl stop munge</span><br><span class="line"></span><br><span class="line">systemctl stop slurmdbd</span><br><span class="line"></span><br><span class="line">systemctl stop slurmctld</span><br><span class="line"></span><br><span class="line">systemctl stop slurmdbd</span><br></pre></td></tr></table></figure><p>开启</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysql</span><br><span class="line">systemctl start munge</span><br><span class="line"></span><br><span class="line">systemctl start slurmdbd</span><br><span class="line"></span><br><span class="line">systemctl start slurmctld</span><br><span class="line"></span><br><span class="line">systemctl start slurmdbd</span><br></pre></td></tr></table></figure><h3 id="查看集群">查看集群</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sinfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一般应该是下面的</span></span><br><span class="line">PARTITION AVAIL  TIMELIMIT  NODES  STATE NODELIST</span><br><span class="line">ptt1*        up   infinite      1   idle localhost</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更详细</span></span><br><span class="line">sinfo -N  -O <span class="string">&quot;nodelist:.6,partition:.10,available:.6,statelong:.12,memory:.12,allocmem:.10,freemem:.10,cpusstate:.16&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前计算任务</span></span><br><span class="line">squeue</span><br></pre></td></tr></table></figure><h3 id="添加用户">添加用户</h3><p>分3级 <code>Cluster</code>、<code>Account</code>、<code>User</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sacctmgr add cluster cluster</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个只是分一下账户</span></span><br><span class="line">sacctmgr add account icpcs Cluster=cluster</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个才是用户</span></span><br><span class="line">sacctmgr add user yuh Account=icpcs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看</span></span><br><span class="line">sacctmgr list Cluster</span><br><span class="line"></span><br><span class="line">sacctmgr list Account</span><br><span class="line"></span><br><span class="line">sacctmgr list User</span><br></pre></td></tr></table></figure><h3 id="管理员常用命令">管理员常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># node1节点排空，不再接受程序提交</span></span><br><span class="line">scontrol update nodename=node1 state=drain reason=<span class="string">&#x27;停电节能&#x27;</span></span><br><span class="line"></span><br><span class="line">scontrol show node node5</span><br><span class="line"></span><br><span class="line"><span class="comment"># node8节点恢复</span></span><br><span class="line">scontrol update nodename=node8 state=resume</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看ptt3分区状态</span></span><br><span class="line">sinfo -p ptt3</span><br><span class="line"><span class="comment"># 输出如下：单次运行最大14天</span></span><br><span class="line"><span class="comment"># PARTITION AVAIL  TIMELIMIT  NODES  STATE NODELIST</span></span><br><span class="line"><span class="comment"># ptt3         up 14-00:00:0      4  drain node[5-8]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ptt3分区程序最大运行时间20160分钟。即14天</span></span><br><span class="line">scontrol update partition=ptt3 MaxTime=20160</span><br><span class="line"></span><br><span class="line"><span class="comment"># 彻底修改某个分区运行时间</span></span><br><span class="line">vim /usr/local/slurm/etc/slurm.conf</span><br><span class="line"><span class="comment"># 最后几行</span></span><br><span class="line"><span class="comment"># PartitionName=ptt3 Nodes=node[5-8] MaxTime=20160 State=UP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看任务</span></span><br><span class="line">sacct -j 264781</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某些用户user的账户account信息以及cpu限制</span></span><br><span class="line">sacctmgr list assoc format=Clusters,Account,User,qos,partition,GrpTRES,Priority</span><br></pre></td></tr></table></figure><h2 id="用户使用">用户使用</h2><p>看这里 ：<a href="./d8e81662.html">服务器与 SLURM 的使用</a></p><h2 id="lammps编译安装">LAMMPS编译安装</h2><p>看这里 ：<a href="./320.html">Linux系统源码编译安装LAMMPS</a></p><p>slurm提交请注意</p><p>申请一个核心一个线程，才最快即</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srun -n 72  --ntasks-per-core 1  --mem=5G lmp -<span class="keyword">in</span> file.in</span><br></pre></td></tr></table></figure><p>72为核心数，<code>--ntasks-per-core</code> 代表一个核心一个进程 <code>--mem=5G</code> 申请的内存，<code>file.in</code> lammps脚本文件名</p><hr><p>本文作者：yuhldr<br>本文地址： <a href="https://yuhldr.github.io/posts/bfa79f01.html">https://yuhldr.github.io/posts/bfa79f01.html</a><br>版权声明：转载请注明出处！</p></div><footer class="post-footer"><div class="reward-container"><div>请我一杯咖啡吧！</div><button>赞赏</button><div class="post-reward"><div><img src="/images/wechatpay.png" alt="yuh 微信"> <span>微信</span></div><div><img src="/images/alipay.png" alt="yuh 支付宝"> <span>支付宝</span></div><div><img src="/images/paypal.png" alt="yuh PayPal"> <span>PayPal</span></div></div></div><div class="followme"><span>欢迎关注我的其它发布渠道</span><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div></div></div><div class="post-tags"><a href="/tags/ubuntu/" rel="tag"><i class="fa fa-tag"></i> ubuntu</a> <a href="/tags/lammps/" rel="tag"><i class="fa fa-tag"></i> lammps</a> <a href="/tags/mpi/" rel="tag"><i class="fa fa-tag"></i> mpi</a> <a href="/tags/slurm/" rel="tag"><i class="fa fa-tag"></i> slurm</a> <a href="/tags/openmpi/" rel="tag"><i class="fa fa-tag"></i> openmpi</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/f85bb316.html" rel="prev" title="从零开始-开发ubuntu版翻译软件"><i class="fa fa-angle-left"></i> 从零开始-开发ubuntu版翻译软件</a></div><div class="post-nav-item"><a href="/posts/d8e81662.html" rel="next" title="slurm集群用户使用指南">slurm集群用户使用指南 <i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments gitalk-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2020 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">yuh</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>站点总字数：</span> <span title="站点总字数">74k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">4:31</span></span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.31/dist/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/comments.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/sidebar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/next-boot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/bookmark.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/pjax.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.1/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/third-party/search/local-search.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/third-party/fancybox.min.js"></script><script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"RYSG1XERuOzIqmlUwKtcV4Ae-gzGzoHsz","app_key":"IeOnd3dJ8WBKLNb0wnDy3rIE","server_url":null,"security":false}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/third-party/statistics/lean-analytics.min.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","cdn":"//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/third-party/math/mathjax.min.js"></script><script src="https://cdn.jsdelivr.net/npm/quicklink@2.3.0/dist/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script><script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"ignores":null,"url":"https://yuhldr.github.io/posts/bfa79f01.html"}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/third-party/quicklink.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous"><script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"yuhldr","repo":"yuhldr.github.io","client_id":"4872df6fdf3422f76314","client_secret":"52ef5ee22e14a43b4706cb491d2b36097ad8dfa6","admin_user":"yuhldr","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"2c5ec31f909b5efb5c8f311015aa086f"}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.21.0/source/js/third-party/comments/gitalk.min.js"></script><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script><script src="https://cdn.jsdelivr.net/gh/yuhldr/live2d-widget@latest/autoload.js"></script></body></html>